
<!-- <ion-header style="color: white;
    background-color: #6b0202e7">
  
    <ion-title>{{storeName}}</ion-title>
 
</ion-header> -->

<!-- <ion-content class="ion-padding">

  
   <ion-card>
    <ion-card-header>
      <ion-card-title>Printer</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-button expand="full" (click)="enableBluetooth()">Enable Bluetooth</ion-button>
      <ion-button expand="full" (click)="listDevices()">List Paired Devices</ion-button>

      <ion-list *ngIf="devices.length > 0">
        <ion-item *ngFor="let d of devices">
          <ion-label>
            <h3>{{ d.name || 'Unknown' }}</h3>
            <p>{{ d.address || d.id }}</p>
          </ion-label>
           <ion-button slot="end" (click)="toggleConnection(d)">
  {{ selectedDevice?.address === d.address ? 'Disconnect' : 'Connect' }}
</ion-button>

        </ion-item>
      </ion-list>

      <p *ngIf="selectedDevice"><strong>Connected to:</strong> {{ selectedDevice.name || selectedDevice.address }}</p>
      <p><small>{{ statusMessage }}</small></p>
    </ion-card-content>
  </ion-card> 

  
  <ion-card>
    <ion-card-header>
      <ion-card-title>Add item</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-item>
        <ion-label position="floating">Item name</ion-label>
        <ion-input [(ngModel)]="itemName" name="itemName"></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Quantity</ion-label>
        <ion-input type="number" [(ngModel)]="quantity" name="quantity"></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Price (number)</ion-label>
        <ion-input type="number" [(ngModel)]="price" name="price"></ion-input>
      </ion-item>

      <ion-button expand="full" color="success" (click)="addItem()">Add to bill</ion-button>
    </ion-card-content>
  </ion-card>

  
  <ion-card *ngIf="items.length > 0">
  <ion-card-header>
    <ion-card-title>Current Bill</ion-card-title>
  </ion-card-header>
  <ion-card-content>

    
    <div class="bill-table">
      <ion-grid>
        <ion-row class="table-header">
          <ion-col size="4"><b>Item</b></ion-col>
          <ion-col size="3" class="ion-text-center"><b>Qty</b></ion-col>
          <ion-col size="2" class="ion-text-center"><b>Price</b></ion-col>
          <ion-col size="2" class="ion-text-center"><b>Total</b></ion-col>
          <ion-col size="1"></ion-col>
        </ion-row>

        <ion-row *ngFor="let it of items; let i = index" class="table-row">
          <ion-col size="4" class="truncate">{{ it.name }}</ion-col>

          <ion-col size="3" class="ion-text-center">
            <ion-button size="small" fill="outline" shape="round" (click)="decreaseQty(i)">-</ion-button>
            <span class="qty">{{ it.qty }}</span>
            <ion-button size="small" fill="outline" shape="round" (click)="increaseQty(i)">+</ion-button>
          </ion-col>

          <ion-col size="2" class="ion-text-center">{{ it.price }}</ion-col>
          <ion-col size="2" class="ion-text-center">{{ it.qty * it.price }}</ion-col>

          <ion-col size="1" class="ion-text-center">
            <ion-button size="small" fill="clear" color="danger" (click)="removeItem(i)">
              ✕
            </ion-button>
          </ion-col>
        </ion-row>

        <ion-row class="table-footer">
          <ion-col size="2" class="ion-text-center"><b>Grand Total:</b></ion-col>
          <ion-col size="6" class="ion-text-center"><b>{{ grandTotal }}</b></ion-col>
        </ion-row>
      </ion-grid>
    </div>



 <ion-item lines="none" class="payment-type-row">
  <ion-label position="stacked" class="payment-label">Payment</ion-label>
  <ion-segment [(ngModel)]="paymentType" value="Cash" class="payment-segment">
    <ion-segment-button value="Cash">
      <ion-label>Cash</ion-label>
    </ion-segment-button>
    <ion-segment-button value="Online">
      <ion-label>Online</ion-label>
    </ion-segment-button>
  </ion-segment>
</ion-item>


    <ion-button expand="full" color="primary" (click)="printReceipt()">
      Print Receipt
    </ion-button>
  </ion-card-content>
</ion-card>

</ion-content> -->


<!-- Above is older with printrecipt*********************************and below is new with database -->



<!-- <ion-content class="ion-padding">


<ion-card>
  <ion-card-header>
    <ion-card-title>Add item</ion-card-title>
  </ion-card-header>
  <ion-card-content>

    <ion-item>
      <ion-label position="floating">Item name</ion-label>
      <ion-input [(ngModel)]="searchText" (ionInput)="onSearchChange($event)"></ion-input>
    </ion-item>

 
    <ion-list *ngIf="showDropdown">
      <ion-item button *ngFor="let item of filteredItems" (click)="selectItem(item)">
        {{ item.itemname }} - {{ item.price | currency:'INR' }}
      </ion-item>
    </ion-list>

   
    <ion-item>
      <ion-label position="floating">Quantity</ion-label>
      <ion-input type="number" [(ngModel)]="quantity"></ion-input>
    </ion-item>

    
    <ion-item>
      <ion-label position="floating">Price</ion-label>
      <ion-input type="number" [(ngModel)]="price"></ion-input>
    </ion-item>

    <ion-button expand="full" color="success" (click)="addItem()">Add to bill</ion-button>
  </ion-card-content>
</ion-card>



<ion-card *ngIf="items.length > 0">
  <ion-card-header>
    <ion-card-title>Current Bill</ion-card-title>
  </ion-card-header>
  <ion-card-content>

    
    <div class="bill-table">
      <ion-grid>
        <ion-row class="table-header">
          <ion-col size="4"><b>Item</b></ion-col>
          <ion-col size="3" class="ion-text-center"><b>Qty</b></ion-col>
          <ion-col size="2" class="ion-text-center"><b>Price</b></ion-col>
          <ion-col size="2" class="ion-text-center"><b>Total</b></ion-col>
          <ion-col size="1"></ion-col>
        </ion-row>

        <ion-row *ngFor="let it of items; let i = index" class="table-row">
          <ion-col size="4" class="truncate">{{ it.name }}</ion-col>

          <ion-col size="3" class="ion-text-center">
            <ion-button size="small" fill="outline" shape="round" (click)="decreaseQty(i)">-</ion-button>
            <span class="qty">{{ it.qty }}</span>
            <ion-button size="small" fill="outline" shape="round" (click)="increaseQty(i)">+</ion-button>
          </ion-col>

          <ion-col size="2" class="ion-text-center">{{ it.price }}</ion-col>
          <ion-col size="2" class="ion-text-center">{{ it.qty * it.price }}</ion-col>

          <ion-col size="1" class="ion-text-center">
            <ion-button size="small" fill="clear" color="danger" (click)="removeItem(i)">
              ✕
            </ion-button>
          </ion-col>
        </ion-row>

        <ion-row class="table-footer">
          <ion-col size="2" class="ion-text-center"><b>Grand Total:</b></ion-col>
          <ion-col size="6" class="ion-text-center"><b>{{ grandTotal }}</b></ion-col>
        </ion-row>
      </ion-grid>
    </div>



 <ion-item lines="none" class="payment-type-row">
  <ion-label position="stacked" class="payment-label">Payment</ion-label>
  <ion-segment [(ngModel)]="paymentType" value="Cash" class="payment-segment">
    <ion-segment-button value="Cash">
      <ion-label>Cash</ion-label>
    </ion-segment-button>
    <ion-segment-button value="Online">
      <ion-label>Online</ion-label>
    </ion-segment-button>
  </ion-segment>
</ion-item>

<ion-item lines="none">
  <ion-label>Print Receipt?</ion-label>
  <ion-checkbox slot="start" [(ngModel)]="shouldPrint"></ion-checkbox>
</ion-item>

    <ion-button expand="full" color="primary" (click)="saveTransaction()">
      Save Transaction
    </ion-button>

    <ion-button expand="full" color="primary" (click)="printReceipt()">
      print Transaction
    </ion-button>
  </ion-card-content>
</ion-card>
</ion-content> -->




<!-- ****************************BELOW IS HOSTED SEPRATE BILL TABLE -->
<!-- <ion-content class="ion-padding">

  
  <ion-card class="tables-card" style="margin-bottom: 15px; padding: 10px;">
    <ion-segment [(ngModel)]="currentTable" scrollable="true">
      <ion-segment-button *ngFor="let t of tablesArray" [value]="t" style="margin-right: 5px;">
        <ion-label>Table {{ t }}</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-card>


  <ion-grid>
    <ion-row>
     
      <ion-col size="12" size-md="6">
        <ion-card style="margin-bottom: 15px;">
          <ion-card-header>
            <ion-card-title>Select Item</ion-card-title>
          </ion-card-header>

          <ion-card-content>

          
            <ion-item style="margin-bottom: 10px;">
              <ion-label position="floating">Search Item</ion-label>
              <ion-input [(ngModel)]="searchText" (ionInput)="onSearchChange($event)"></ion-input>
            </ion-item>

 
            <ion-grid>
              <ion-row>
                <ion-col size="6" *ngFor="let item of filteredItems" style="margin-bottom: 10px;">
                  <ion-button
                    class="item-btn"
                    expand="block"
                    fill="solid"
                    [color]="selectedItemId === item.itemid ? 'success' : 'primary'"
                    (click)="selectItem(item)">
                    {{ item.itemname }} <br />
                    <small>{{ item.price | currency:'INR' }}</small>
                  </ion-button>
                </ion-col>
              </ion-row>
            </ion-grid>

          </ion-card-content>
        </ion-card>
      </ion-col>

      
      <ion-col size="12" size-md="6">
        <ion-card *ngIf="tables[currentTable].items.length > 0" style="margin-bottom: 15px;">
          <ion-card-header>
            <ion-card-title>Current Bill (Table {{ currentTable }})</ion-card-title>
          </ion-card-header>
          <ion-card-content style="padding: 10px;">

           
            <div class="bill-table">
              <ion-grid>
              
                <ion-row class="table-header" style="margin-bottom: 5px;">
                  <ion-col size="4"><b>Item</b></ion-col>
                  <ion-col size="3" class="ion-text-center"><b>Qty</b></ion-col>
                  <ion-col size="2" class="ion-text-center"><b>Price</b></ion-col>
                  <ion-col size="2" class="ion-text-center"><b>Total</b></ion-col>
                  <ion-col size="1"></ion-col>
                </ion-row>

                
                <ion-row *ngFor="let it of tables[currentTable].items; let i = index" class="table-row">
                  <ion-col size="4" class="truncate">{{ it.name }}</ion-col>

                  <ion-col size="3" class="ion-text-center">
                    <ion-button size="small" fill="solid" shape="round" color="secondary" (click)="decreaseQty(i)">-</ion-button>
                    <span class="qty">{{ it.qty }}</span>
                    <ion-button size="small" fill="solid" shape="round" color="secondary" (click)="increaseQty(i)">+</ion-button>
                  </ion-col>

                  <ion-col size="2" class="ion-text-center">{{ it.price }}</ion-col>
                  <ion-col size="2" class="ion-text-center">{{ it.qty * it.price }}</ion-col>

                  <ion-col size="1" class="ion-text-center">
                    <ion-button size="small" fill="clear" color="danger" (click)="removeItem(i)">✕</ion-button>
                  </ion-col>
                </ion-row>

               
                <ion-row class="table-footer" style="margin-top: 10px;">
                  <ion-col size="4" class="ion-text-right"><b>Grand Total:</b></ion-col>
                  <ion-col size="8" class="ion-text-left"><b>{{ grandTotal }}</b></ion-col>
                </ion-row>
              </ion-grid>
            </div>

          
            <ion-item lines="none" class="payment-type-row" style="margin-top: 15px;">
              <ion-label position="stacked" class="payment-label">Payment</ion-label>
              <ion-segment [(ngModel)]="tables[currentTable].paymentType" value="Cash" class="payment-segment">
                <ion-segment-button value="Cash"><ion-label>Cash</ion-label></ion-segment-button>
                <ion-segment-button value="Online"><ion-label>Online</ion-label></ion-segment-button>
              </ion-segment>
            </ion-item>

          
            <ion-item lines="none" style="margin-top: 10px;">
              <ion-label>Print Receipt?</ion-label>
              <ion-checkbox slot="start" [(ngModel)]="tables[currentTable].shouldPrint"></ion-checkbox>
            </ion-item>

            
            <ion-button expand="full" color="primary" style="margin-top: 10px;" (click)="saveTransaction()">
              Save Transaction
            </ion-button>

            <ion-button expand="full" color="success" style="margin-top: 10px;" (click)="printReceipt()">
              <ion-icon name="print-outline" slot="start"></ion-icon>
              Print Transaction
            </ion-button>

          </ion-card-content>
        </ion-card>

        
        <ion-card *ngIf="tables[currentTable].items.length === 0">
          <ion-card-content>No items added yet for Table {{ currentTable }}.</ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content> -->




<!-- *******************************BELOW IS AASHIRWAD HOTEL CODE**************************** -->
<ion-header>
  <ion-toolbar style="--background: #450101ef; --color: white;">
    <ion-title>{{storeName}}</ion-title>
  </ion-toolbar>
</ion-header>
<ion-content class="ion-padding">

  
  <ion-card class="tables-card" style="margin-bottom: 15px; padding: 10px;">
    <ion-segment [(ngModel)]="currentTable" scrollable="true">
      <ion-segment-button *ngFor="let t of tablesArray" [value]="t" style="margin-right: 5px; ">
        <ion-label>टेबल {{ t }}</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-card>


  <ion-grid>
    <ion-row>
     

      


      <ion-col size="12" size-md="8">
        <ion-card>
          <!-- <ion-card-header>
            <ion-card-title>Select Item</ion-card-title>
          </ion-card-header> -->

          <ion-card-content>

          
            <ion-item>
              <ion-label position="floating">पदार्थ शोधा</ion-label>
              <ion-input [(ngModel)]="searchText" (ionInput)="onSearchChange($event)"></ion-input>
            </ion-item>

 
            <!-- <ion-grid>
              <ion-row>
                <ion-col size="3" *ngFor="let item of filteredItems" style="margin-bottom: 10px;">
                  <ion-button
                    class="item-btn"
                    expand="block"
                    fill="solid"
                    [color]="selectedItemId === item.itemid ? 'danger' : 'brown'"
                    (click)="selectItem(item)">
                    {{ item.itemname }} <br />
                    <small>{{ item.price | currency:'INR' }}</small>
                  </ion-button>
                </ion-col>
              </ion-row>
            </ion-grid> -->

<ion-grid>
  <ion-row>
    <ion-col
      size="3"
      *ngFor="let item of filteredItems"
      class="item-col"
    >
      <ion-button
        class="item-btn"
        expand="block"
        fill="solid"
        [class.selected]="selectedItemId === item.itemid"
        (click)="selectItem(item)"
      >
        <div class="item-content">
          <div class="item-name">
            {{ item.itemname }}
          </div>
          <div class="item-price">
            {{ item.price | currency:'INR' }}
          </div>
        </div>
      </ion-button>
    </ion-col>
  </ion-row>
</ion-grid>





            <!-- <ion-grid>
  <ion-row>
    <ion-col size="4" *ngFor="let item of filteredItems" style="margin-bottom: 10px;">
      <ion-button
        class="item-btn"
        expand="block"
        fill="solid"
        [color]="selectedItemId === item.itemid ? 'success' : 'light'"
        (click)="selectItem(item)">
        
        <div style="display: flex; flex-direction: column; align-items: center; width: 100%;">
          
          
           <ion-img 
            [src]="'assets/ashirvad.jpeg'" 
            style="width: 80px; height: 60px; object-fit: cover; border-radius: 10px; margin-bottom: 0px;">
          </ion-img>
          
         
          <div style="text-align: center; line-height: 1.2;">
            <strong>{{ item.itemname }}</strong><br>
            <small>{{ item.price | currency:'INR' }}</small>
          </div>

        </div>

      </ion-button>
    </ion-col>
  </ion-row>
            </ion-grid> -->


          </ion-card-content>
        </ion-card>
      </ion-col>







         <ion-col size="12" size-md="4">
        <ion-card *ngIf="tables[currentTable].items.length > 0" style="margin-bottom: 15px;">
          <!-- <ion-card-header>
            <ion-card-title>Current Bill (Table {{ currentTable }})</ion-card-title>
          </ion-card-header> -->
          <ion-card-content style="padding: 0px;">

            <!-- Bill Table -->
              <ion-row class="table-header" style="margin-bottom: 5px;">
                  <ion-col size="4"><b>पदार्थ</b></ion-col>
                  <ion-col size="3" class="ion-text-center"><b>प्रमाण</b></ion-col>
                  <ion-col size="2" class="ion-text-center"><b>किंमत</b></ion-col>
                  <ion-col size="2" class="ion-text-center"><b>एकूण</b></ion-col>
                  <ion-col size="1"></ion-col>
                </ion-row>
            <div class="bill-table">
              <ion-grid>
                <!-- Header -->
               

                <!-- Items -->
                <ion-row *ngFor="let it of tables[currentTable].items; let i = index" class="table-row">
                  <ion-col size="4" class="truncate">{{ it.name }}</ion-col>

                  <!-- <ion-col size="3" class="ion-text-center">
                    <ion-button size="small" fill="solid" shape="round" color="secondary" (click)="decreaseQty(i)">-</ion-button>
                    <span class="qty">{{ it.qty }}</span>
                    <ion-button size="small" fill="solid" shape="round" color="secondary" (click)="increaseQty(i)">+</ion-button>
                  </ion-col> -->




 <ion-col size="3" class="ion-text-center qty-col">

  <!-- Decrease button -->
  <ion-button
    size="small"
    fill="solid"
    
    (click)="singleClick(i, 'decrease')"
    (press)="startHold(i, 'decrease')"
  >
    -
  </ion-button>

  <!-- Editable quantity input -->
  <ion-input
    type="number"
    min="1"
    [(ngModel)]="tables[currentTable].items[i].qty"
    (ionChange)="onQtyChange(i)"
    class="qty-input"
    inputmode="numeric"
  ></ion-input>

  <!-- Increase button -->
  <ion-button
    size="small"
    fill="solid"
    
    (click)="singleClick(i, 'increase')"
    (press)="startHold(i, 'increase')"
  >
    +
  </ion-button>

</ion-col>




                     <!-- <ion-col size="3" class="ion-text-center">
                     <ion-button size="small" fill="solid"  (click)="decreaseQty(i)">-</ion-button>
                      <span class="qty">{{ it.qty }}</span>
                       <ion-button size="small" fill="solid" (click)="increaseQty(i)">+</ion-button>
                     </ion-col> -->

                  <ion-col size="2" class="ion-text-center">{{ it.price }}</ion-col>
                  <ion-col size="2" class="ion-text-center">{{ it.qty * it.price }}</ion-col>

                  <ion-col size="1" class="ion-text-center">
                    <ion-button size="small" fill="clear" color="danger" (click)="removeItem(i)">✕</ion-button>
                  </ion-col>
                </ion-row>

                <!-- Footer -->
                
              </ion-grid>
             
            </div>
             <ion-row class="table-footer" style="margin-top: 10px;">
                  <ion-col size="4" class="ion-text-right"><b>एकूण रक्कम:</b></ion-col>
                  <ion-col size="8" class="ion-text-left"><b>{{ grandTotal }}</b></ion-col>
              </ion-row>

            <!-- Payment type selection -->
            <ion-item lines="none" class="payment-type-row" style="margin-top: 15px;">
              <ion-label position="stacked" class="payment-label">Payment</ion-label>
              <ion-segment [(ngModel)]="tables[currentTable].paymentType" value="Cash" class="payment-segment">
                <ion-segment-button value="Cash"><ion-label>रोख</ion-label></ion-segment-button>
                <ion-segment-button value="Online"><ion-label>ऑनलाईन</ion-label></ion-segment-button>
              </ion-segment>
            </ion-item>

            <!-- Print Option -->
             <!-- <ion-item lines="none" style="margin-top: 10px;">
              <ion-label>Print Receipt?</ion-label>
              <ion-checkbox slot="start"  [checked]="tables[currentTable].shouldPrint" [(ngModel)]="tables[currentTable].shouldPrint"></ion-checkbox>
            </ion-item>  -->


            <!-- Print Option -->
<!-- <ion-item lines="none" style="margin-top: 10px;">
  <ion-label>Print Receipt?</ion-label>
  <ion-checkbox
    slot="start"
    [(ngModel)]="tables[currentTable].shouldPrint">
  </ion-checkbox>
</ion-item> -->


            <!-- Action Buttons -->
            <ion-button expand="full" fill="solid"  style="margin-top: 30px; margin-bottom: 10px; background-color: #450101ef;" (click)="saveTransaction()">
             बिल तयार करा
            </ion-button>

            <!-- <ion-button expand="full" style="margin-top: 10px;" (click)="printReceipt()">
              <ion-icon name="print-outline" slot="start"></ion-icon>
              Print Transaction
            </ion-button> -->

          </ion-card-content>
        </ion-card>

        <!-- Empty Bill -->
        <ion-card *ngIf="tables[currentTable].items.length === 0">
          <ion-card-content> टेबलसाठी अजून आयटम अ‍ॅड केले नाहीत {{ currentTable }}.</ion-card-content>
        </ion-card>
      </ion-col>


      
     
    </ion-row>
  </ion-grid>
</ion-content>


